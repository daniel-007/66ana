# 斗鱼爬虫

## 目标：
1. 不允许多个爬虫同时爬同一个房间
2. 保活，worker挂掉之后需要清理，保证每个房间都真实在爬
3. 发任务尽量快，不阻塞多个worker，不堆积
4. 发任务尽量均衡，靠前的房间人数比较多，不要都分发给同一个worker

## 之后要做的事：
- [ ] 等爬虫子系统稳定之后（即将稳定了），就可以考虑做一下数据库的性能测试，分析一下日数据量。优化一下查询之类的工作。
- [ ] 稳定之后可以插入更多类型的数据（比如进房间、房管信息等）
- [x] socks代理服务器

## 架构几件事:
- [ ] postgres监控平台或linux监控平台
- [ ] raid或ssd，换个服务器显卡省省电（亮屏卡）
- [ ] 分表
- [ ] redis的pub/sub好像有点坑，换成ZeroMQ试试

## 需求：
### 【零散需求】
spider挂掉之后需要检测
舆情分析 每10分钟打分的图表📈
收入分析 图表
弹幕数量 图表

### 【监控大盘】
- [ ] 当前正在抓取的房间数（可展开看列表）
- [ ] 弹幕数量折线图
- [ ] 弹幕文字量折线图
- [ ] 礼物数量折线图
- [ ] 礼物金额折线图
- [ ] 主播收入排行
- [ ] 主播弹幕排行
- [ ] 主播人数排行
- [ ] 主播关注排行

### 【系统】
- [ ] 爬虫机器数
- [ ] 暂停分配，恢复分配（可以等待爬虫机器都起来之后再分配任务，用lock实现）

## 灵感（细碎的灵感记录在这里）
分配任务用push pull，有剩余cap的才pull，没有的不pull。使用带buffer的chan实现
